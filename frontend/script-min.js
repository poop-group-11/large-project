var connection,sessionId,hooks=[],hookList=new Object;function startGame(){document.getElementById("start").style.display="none",document.getElementById("back").style.display="none",document.getElementById("settings-menu").style.display="none",document.getElementById("settings-button").style.display="none",document.getElementById("session-code").style.display="none",connection.emit("sessionStart",sessionId),initGame(),draw()}function createUser(e){hooks[userCount]=new Hook(e,userCount),hookList[e]=userCount++,ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);for(var n=0;n<userCount;n++)hooks[n].origin={x:ctx.canvas.width/(userCount+1)*(hooks[n].id+1)-hooks[n].img.width/2,y:0},hooks[n].x=hooks[n].origin.x-hooks[n].img.width/2,hooks[n].y=hooks[n].origin.y+hooks[n].length,hooks[n].draw()}function newSession(){document.getElementById("home-screen").style.display="none",document.getElementById("game-screen").style.display="grid",document.getElementById("settings-menu").style.display="none",document.getElementById("game-music").play(),connection=io("http://localhost"),fetch("http://localhost/api/openSession",{method:"POST"}).then(e=>e.json()).then(function(e){1==e.success?(sessionId=e.message,connection.emit("joinSession",sessionId),connection.on("browserJoined",function(){console.log("Successful Connection!")}),document.getElementById("session-code").innerHTML=sessionId,connection.on("userJoined",createUser)):backToMenu()}).catch(e=>console.log(e)),loadAssets()}function backToMenu(){document.getElementById("home-screen").style.display="grid",document.getElementById("game-screen").style.display="none",document.getElementById("settings-menu").style.display="none",document.getElementById("game-music").pause()}function displaySettings(e){document.getElementById("settings-menu").style.display=e}
var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),fishCount=10,userCount=0,scoreGoal=11;
var prog=document.getElementById("progress-bar"),width=1,assets=21;function loadImg(s){var e=new Image;return e.onload=function(){width+=100/21,prog.style.width=width+"%",width>=100&&(prog.parentElement.parentElement.style.display="none")},e.src=s,e}const fishAssets=[];function pushAsset(s,e){fishAssets.push({left:loadImg(s),right:loadImg(e)})}var fishHook;function loadAssets(){fishHook=loadImg("Assets\\fishHook.svg"),pushAsset("Assets\\betaleft.svg","Assets\\betaright.svg"),pushAsset("Assets\\clownfishLeft.svg","Assets\\clownfish.svg"),pushAsset("Assets\\flounderleft.svg","Assets\\flounderright.svg"),pushAsset("Assets\\hammerleft.svg","Assets\\hammerright.svg"),pushAsset("Assets\\jellyleft.svg","Assets\\jellyright.svg"),pushAsset("Assets\\krabbyleft.svg","Assets\\krabbyright.svg"),pushAsset("Assets\\marlinLeft.svg","Assets\\marlin.svg"),pushAsset("Assets\\pufferleft.svg","Assets\\pufferright.svg"),pushAsset("Assets\\rainbowleft.svg","Assets\\rainbowright.svg"),pushAsset("Assets\\seahorseleft.svg","Assets\\seahorseright.svg")}
class Fish{constructor(h){this.id=h;var t=Math.floor(Math.random()*fishAssets.length);this.img=fishAssets[t].right,this.imgLeft=fishAssets[t].left,this.width=this.img.width,this.height=this.img.height,this.x=Math.floor(Math.random()*ctx.canvas.width),this.y=Math.floor(Math.random()*(ctx.canvas.height-this.height)),this.dX=Math.floor(3*Math.random())+1,this.dY=Math.floor(8*Math.random())+-4,this.hooked=-1,this.right=!!Math.round(Math.random())}respawn(){var h=Math.floor(Math.random()*fishAssets.length);this.img=fishAssets[h].right,this.imgLeft=fishAssets[h].left,this.width=this.img.width,this.height=this.img.height,this.right=!!Math.round(Math.random()),this.right?this.x=-this.width:this.x=ctx.canvas.width,this.y=Math.floor(Math.random()*(ctx.canvas.height-this.height)),this.dX=Math.floor(3*Math.random())+1,this.dY=Math.floor(8*Math.random())+-4,this.hooked=-1}move(){-1==this.hooked?(this.right?this.x+=this.dX:this.x-=this.dX,this.y+=this.dY,this.x>ctx.canvas.width?this.respawn():this.x<-this.width&&this.respawn(),(this.y+this.height>ctx.canvas.height||this.y<0)&&(this.dY=-this.dY)):(this.x=hooks[this.hooked].x,this.y=hooks[this.hooked].y)}draw(){-1==this.hooked?this.right?ctx.drawImage(this.img,this.x,this.y,this.width,this.height):ctx.drawImage(this.imgLeft,this.x,this.y,this.width,this.height):(ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(-Math.PI/2),ctx.drawImage(this.img,-this.width-hooks[this.hooked].img.height/2,hooks[this.hooked].img.width/2-this.height/2,this.width,this.height),ctx.restore())}changeDir(){this.dX+=Math.random()<.5?-1:1,this.dY+=Math.random()<.5?-1:1,this.dX>4&&(this.dX=4),this.dX<1&&(this.dX=1),this.dY>4&&(this.dY=4),this.dY<-4&&(this.dY=-4)}}
class Hook{constructor(i,t){this.id=t,this.user=i,this.img=fishHook,this.origin={x:ctx.canvas.width/(userCount+1)*(t+1)-this.img.width/2,y:0},this.length=50,this.dL=0,this.x=this.origin.x-this.img.width/2,this.y=this.origin.y+this.length,this.hooked=-1,this.score=0,this.cast=!1,this.lobby=!0}reset(){this.cast=!1,this.length=-this.img.height-10,this.y=this.origin.y+this.length}castLine(i){this.cast=!0,this.dL=10*i,new Audio("Assets\\castSound.mp3").play()}draw(){ctx.beginPath(),ctx.moveTo(this.origin.x,this.origin.y),ctx.lineTo(this.origin.x,this.origin.y+this.length),ctx.lineWidth=4,ctx.strokeStyle="black",ctx.stroke(),ctx.closePath(),this.lobby||(ctx.font="30px Chelsea Market",ctx.fillText("Score:"+this.score.toString(),this.origin.x,this.origin.y+30)),ctx.drawImage(this.img,this.x+1,this.y,this.img.width,this.img.height)}move(){this.origin={x:ctx.canvas.width/(userCount+1)*(this.id+1)-this.img.width/2,y:0},this.cast&&(this.x=this.origin.x-this.img.width/2,this.length+=this.dL,this.y=this.origin.y+this.length,this.length<-this.img.height?(this.length=-this.img.height,this.dL=-this.dL):this.length+this.img.height>ctx.canvas.height&&(this.length=ctx.canvas.height-this.img.height,this.dL=-this.dL),this.dL>0?this.dL-=1:this.dL<0&&(this.dL+=1))}catch(){-1!=this.hooked&&this.y+this.img.height<0&&(new Audio("Assets\\caughtFish.mp3").play(),this.score+=1,this.score>winning.score&&(winning.user=this.user,winning.score=this.score),connection.emit("fishCaught",this.user,fish[this.hooked]),fish[this.hooked].respawn(),this.hooked=-1,this.reset())}}
ctx.canvas.height=window.innerHeight,ctx.canvas.width=window.innerWidth;var winning=new Object;function initGame(){for(var n=0;n<userCount;n++)hooks[n].lobby=!1,hooks[n].length=-hooks[n].img.height-10,hooks[n].y=this.origin.y+this.length;for(n=0;n<fishCount;n++)fish[n]=new Fish(n);winning.score=0}function listen(){connection.on("casted",findAndSend),connection.on("reeled",directionDetermine)}function directionDetermine(n,i){hooks[hookList[n]].castLine(i)}function findAndSend(n){hooks[hookList[n]].castLine(1)}function drawHooks(){for(var n=0;n<userCount;n++)hooks[n].move(),hooks[n].draw(),hooks[n].catch()}function drawFish(){for(var n=0;n<fishCount;n++)fish[n].move(),fish[n].draw()}function collide(n,i){n.x<i.x+i.width&&n.x+n.img.width>i.x&&n.y<i.y+i.height&&n.y+n.img.height>i.y&&(n.hooked=i.id,i.hooked=n.id)}function collision(){for(var n=0;n<userCount;n++)for(var i=0;i<fishCount;i++)-1==hooks[n].hooked&&-1==fish[i].hooked&&collide(hooks[n],fish[i])}function talk(){winning.score>=scoreGoal&&connection.emit("endSession",(sessionId,winning.user))}function draw(){ctx.canvas.height=window.innerHeight,ctx.canvas.width=window.innerWidth,ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),listen(),drawHooks(),drawFish(),collision(),talk(),requestAnimationFrame(draw)}fish=[];
